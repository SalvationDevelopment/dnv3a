The concatenation of the socket messages defines a (potentially infinite) list
of null-terminated parts, events. (So events can span several messages, even if
they usually do not.)
Each event is a comma-separated list with the first value being the event type.
Commas in the data are escaped as \, backslashes as \\.

List of events:

Legend:

+ = we handle it
ModStatus = 0 for regular users, >0 for mods in increasing order of importance I think
LoginToken = token gotten from the login, equal to md5(password)
DuelMode = ar/au/tu (advanced rated, etc.)
UserTitle = Username in duel mode, "User1 ({Rating}) | User2 ({Rating})" in watch mode
Rating = Format "1178/437" or so, or empty
DuelListToken = 32 random hex-chars
DuelState = Rock-paper-scissors/Turn pick/Duel/Siding
Avatar = E.g. "0/1.jpg". Appended to AVATAR_START in urls.txt for a ~500x500 px image. Can perhaps be empty.
WatcherListStr = E.g. "simonlindholm,0,simonlindholm4,0".


Outgoing:

+ Connect10, Username, {LoginToken}, 32-byte random hex

+ Heartbeat -> "Heartbeat" event returned (used for testing disconnects)

+ Load duel room -> "Load duel room" event returned (joining/messaging can happen in between)

+ Add friend, Name

+ Delete friend, Name

* Get deck data -> "Get deck data" event returned

* Private message, Receiver, Message

+ Watch duel, Mode, Title, Token, Password

* Join duel, Mode, Deck, Title, Token, Password


Incoming:

+ Connected, {ModStatus}

+ Rejected -> Can't connect for whatever reason (incorrect username/password or wrong protocol, usually)

+ Already logged in

+ Banned

+ Over limit

+ Heartbeat

+ Global message, Name, Message, {ModStatus} -> message in global chat

+ Load duel room, Selected Deck, (Deck name, IsAdvanced :bool)*

+ Add duels, ({DuelMode}, {UserTitle}, {Rating}, Duel note, Has password :bool, Allow watch :bool, {DuelListToken})*

+ Add watches = same format as 'Add duels', see matchmaking.js for details

+ Remove duels, ({DuelMode}, {UserTitle}, {DuelListToken})*

+ Remove watches = like 'Remove duels'

* Timed out -> socket 'close' will come shortly

+ Online users, (Name, {ModStatus})*

+ Offline users, Name*

+ Chat unlock -> You can now chat again! (The chat is locked on start and after sending messages.)

+ Friends, Name*

+ Add friend, Name

+ Delete friend, Name

* Chat error [, Reason] -> E.g. "Invalid request" which happens on Unicode... Also unlocks the chat, unless the reason is "Quick chat" (= chatting when locked, presumably).

* Async error [, Reason] -> E.g. "<user> is not your friend".

* Error [, Reason]

* Private message, From, To, Message, {ModStatus}

* Leave duel, Reason [, Alternative Duel Offer Message]

+ Watch duel, {DuelState}, (Name, {Avatar}, Back, Color1, Color2, Rating, Reputation, Has donated: bool)*2, {WatcherListStr} (Followed by another message, in some cases, perhaps related to matches and side-decking.)
